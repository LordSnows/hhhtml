<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tracking Link Generator</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 600px;
    margin: 2em auto;
    padding: 1em;
    background: #f9f9f9;
    color: #333;
  }
  h1 {
    text-align: center;
    color: #007bff;
  }
  label {
    font-weight: bold;
  }
  input[type="text"] {
    width: 100%;
    padding: 0.5em;
    margin: 0.5em 0 1em 0;
    font-size: 1em;
  }
  button {
    background: #007bff;
    border: none;
    color: white;
    padding: 0.6em 1.2em;
    font-size: 1em;
    cursor: pointer;
    border-radius: 4px;
  }
  button:hover {
    background: #0056b3;
  }
  #generatedLink {
    margin-top: 1em;
    word-break: break-all;
    background: #eaf4ff;
    padding: 0.7em;
    border-radius: 4px;
  }
  #locationInfo {
    margin-top: 1em;
    padding: 1em;
    background: #dee7ff;
    border-radius: 6px;
  }
  a {
    color: #007bff;
  }
</style>
</head>
<body>
  <h1>Tracking Link Generator</h1>

  <div id="createLinkSection" style="display:none;">
    <p><strong>Tracking Link:</strong></p>
    <div id="generatedLink"></div>
    <p>Share this link to track location of visitors.</p>
  </div>

  <div id="homeSection">
    <label for="linkIdInput">Enter tracking ID (any identifier):</label>
    <input type="text" id="linkIdInput" placeholder="Example: campaign1" />
    <button id="generateBtn">Generate Tracking Link</button>
  </div>

  <div id="trackSection" style="display:none;">
    <h2>Your Location is:</h2>
    <div id="locationInfo">Loading location data...</div>
  </div>

<script>
  (function(){
    const urlParams = new URLSearchParams(window.location.search);
    const trackId = urlParams.get('track');

    const homeSection = document.getElementById('homeSection');
    const createLinkSection = document.getElementById('createLinkSection');
    const generatedLinkDiv = document.getElementById('generatedLink');
    const generateBtn = document.getElementById('generateBtn');
    const linkIdInput = document.getElementById('linkIdInput');
    const trackSection = document.getElementById('trackSection');
    const locationInfo = document.getElementById('locationInfo');

    function getLocationByIP() {
      // Using free IP geolocation API ipapi.co
      fetch('https://ipapi.co/json/')
        .then((response) => response.json())
        .then((data) => {
          if(data.error) {
            locationInfo.textContent = 'Could not retrieve location data.';
            return;
          }
          let info = `IP: ${data.ip}\n`;
          if(trackId) info += `Tracking ID: ${trackId}\n`;
          info += `City: ${data.city}\nRegion: ${data.region}\nCountry: ${data.country_name}\nLatitude: ${data.latitude}\nLongitude: ${data.longitude}`;
          locationInfo.textContent = info;
          // Optionally send this info somewhere or log it via backend
        })
        .catch(() => {
          locationInfo.textContent = 'Failed to fetch location information.';
        });
    }

    if(trackId) {
      // If opened with ?track= param, show location tracking page
      homeSection.style.display = 'none';
      createLinkSection.style.display = 'none';
      trackSection.style.display = 'block';
      getLocationByIP();
    } else {
      // Show home - create link UI
      homeSection.style.display = 'block';
      createLinkSection.style.display = 'none';
      trackSection.style.display = 'none';

      generateBtn.addEventListener('click', () => {
        let id = linkIdInput.value.trim();
        if(!id) {
          alert('Please enter a valid tracking ID.');
          return;
        }
        const loc = window.location;
        // create a url with ?track=id param
        const link = loc.protocol + '//' + loc.host + loc.pathname + '?track=' + encodeURIComponent(id);
        generatedLinkDiv.textContent = link;
        createLinkSection.style.display = 'block';
      });
    }
  })();
</script>
</body>
</html>
